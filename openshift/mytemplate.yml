# @format

apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: my-template
objects:
  # - kind: ImageStream
  #   apiVersion: v1
  #   metadata:
  #     annotations:
  #       description: keeps track of changes in the application image
  #     name: ${APP_NAME}
  # - kind: BuildConfig
  # apiVersion: v1
  # metadata:
  #   name: ${APP_NAME}
  #   namespace: ${PROJECT_NAME}
  #   labels:
  #     app: ${APP_NAME}
  # spec:
  #   nodeSelector: null
  #   output:
  #     to:
  #       kind: ImageStreamTag
  #       name: '${APP_NAME}:latest'
  #   successfulBuildHistoryLimit: 5
  #   failedBuildHistoryLimit: 5
  #   strategy:
  #     type: Docker
  #     dockerStrategy:
  #       dockerfilePath: Dockerfile
  #     postCommit: {}
  # source:
  #   type: Git
  #   git:
  #     url: ${APP_GIT_URL}
  #     ref: ${BRANCH_NAME}
  #   contextDir: /
  # triggers:
  #   - type: Generic
  #     generic:
  #       secretReference:
  #         name: ${APP_NAME}-generic-webhook-secret
  #   - type: GitHub
  #     github:
  #       secretReference:
  #         name: ${APP_NAME}-gighub-webhook-secret
  #   - type: ConfigChange
  # runPolicy: Serial
  - kind: DeploymentConfig
    apiVersion: v1
    metadata:
      annotations:
      name: ${APP_NAME}
      namespace: ${PROJECT_NAME}
      labels:
        app: ${APP_NAME}
    spec:
      selector:
        app: ${APP_NAME}
        deploymentConfig: ${APP_NAME}
      template:
        spec:
          containers:
            - name: ${APP_NAME}
              image: >-
                ghcr.io/bcgov/slam-api@sha256:a65d61ec87cdc40c8945ebeb4bc486fb50bb849195a44d96ebce471a5ecf201e
              ports:
                - containerPort: 3333
                  protocol: TCP
              resources: {}
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              imagePullPolicy: IfNotPresent
  - kind: Service
    apiVersion: v1
    metadata:
      annotations:
      name: ${APP_NAME}
      namespace: ${PROJECT_NAME}
      labels:
        app: ${APP_NAME}
    spec:
      ports:
        - name: 8080-tcp
          protocol: TCP
          port: 8080
          targetPort: 8080
      selector:
        app: ${APP_NAME}
        deploymentConfig: ${APP_NAME}
      type: ClusterIP
      sessionAffinity: None
  - kind: Route
    apiVersion: route.openshift.io/v1
    metadata:
      name: ${APP_NAME}
      namespace: ${PROJECT_NAME}
      labels:
        app: ${APP_NAME}
      annotations:
    spec:
      to:
        kind: Service
        name: ${APP_NAME}
        weight: 100
      port:
        targetPort: 8080-tcp
    wildcardPolicy: None
parameters:
  - name: APP_NAME
    displayName: Application Name
    required: true
    value: slam-api
  - name: PROJECT_NAME
    displayName: Project Name
    required: true
    value: ca94a8-tools
  - name: APP_GIT_URL
    displayName: Application Source Git URL
    required: false
  - name: BRANCH_NAME
    displayName: Branch Name
    required: true
    value: main
